/**
 * @overview ajax操作模块（包括jsonp）
 * @author mile 295504163@qq.com
 * @createDate 2016-08-01
 * @lastModifiedDate 2016-08-01
 * @lastModifiedBy mile
 * @version 0.0.1
 */
'use strict';(function(d,e){if(d.ajax){return}var k=null,h=false,c=null,f=function(m){return Object.prototype.toString.call(m)==="[object Function]"};function j(p){var r,n,q,s,o,m=[];if(p&&p.data){if(typeof p.data==="string"){p.data=p.data.split("&");for(r=0,n=p.data.length;r<n;r++){q=p.data[r].split("=")[0];s=p.data[r].split("=")[1];p.data[r]=encodeURIComponent(q)+"="+encodeURIComponent(s)}p.data=p.data.join("&")}else{if(typeof p.data==="object"){for(o in p.data){if(p.data&&p.data[o]){s=p.data[o].toString();o=encodeURIComponent(o);s=encodeURIComponent(s);m.push(o+"="+s)}}p.data=m.join("&")}}if(p.type==="get"||p.data_type==="jsonp"){p.url+=p.url.indexOf("?")>-1?"&"+p.data:"?"+p.data}}}function b(m){if(typeof m==="object"){return m}else{if(window.JSON&&window.JSON.parse){return window.JSON.parse(m)}else{try{return(new Function("return "+m))()}catch(n){throw new Error("错误名字："+n.name+".错误信息："+n.message);return m}}}}function i(m,n){if(m&&m.timeout){c=setTimeout(function(){if(m.data_type==="jsonp"){n.head_tag.removeChild(n.script);try{delete window[n.callback]}catch(o){window[n.callback]=null}}else{h=true;k&&k.abort()}m.error("无状态码","请求超时")},m.timeout)}}function a(n){var m=document.createElement("script"),p=document.getElementsByTagName("head")[0],o=new Date().getTime()+Math.round(Math.random()*1000),q="JSONP_"+o;window[q]=function(r){clearTimeout(c);try{delete window[q]}catch(s){window[q]=null}p.removeChild(m);n.success(r)};m.src=n.url+(n.url.indexOf("?")>-1?"&":"?")+"callback="+q;m.type="text/javascript";p.appendChild(m);i(n,{callback:q,script:m,head_tag:p})}function g(n){var o,m,p=function(){if(window.XMLHttpRequest){return new XMLHttpRequest()}else{m=["Microsoft","msxm3","msxml2","msxml1"];for(o=0;o<m.length;o++){try{return new ActiveXObject(m[o]+".XMLHTTP")}catch(q){}}}};k=p();k.open(n.type,n.url,n.async);if(n.type==="post"&&!n.content_type){k.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=gbk")}else{if(n.content_type){k.setRequestHeader("Content-Type",n.content_type)}}k.onreadystatechange=function(){if(k.readyState===4){if(n&&n.timeout){if(h){return}clearTimeout(c)}if((k.status>=200&&k.status<300)||k.status==304){n.success(b(k.responseText))}else{n.error(k.status,k.statusText)}}};k.send(n.type==="get"?null:n.data);i(n)}function l(m){m.type=m.type.toLowerCase();j(m);m.before(m);if(m.data_type==="jsonp"){a(m)}else{g(m)}}d.ajax=function(m){l({url:m.url||"",type:m.type||"GET",data:m.data||null,content_type:m.contentType||"",data_type:m.dataType||"",timeout:m.timeout,async:m.async===e?true:!!m.async,before:m.before||function(){},error:m.error||function(){},success:m.success||function(){}})};d.ajax.get=function(n,o,p,m){if(f(o)){if(typeof p=="string"){m=p}p=o;o=null}l({url:n||"",type:"GET",data:o||null,content_type:"",data_type:m||"",async:true,before:function(){},error:function(){},success:p||function(){}})};d.ajax.post=function(n,o,p,m){if(f(o)){if(typeof p=="string"){m=p}p=o;o=null}l({url:n||"",type:"POST",data:o||null,content_type:"",async:true,data_type:m||"",before:function(){},error:function(){},success:p||function(){}})}})(this);
